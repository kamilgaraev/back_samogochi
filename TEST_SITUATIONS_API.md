# Тестирование API - Игровые ситуации

## Пошаговое тестирование системы ситуаций

### Подготовка к тестированию

1. Запустить миграции и сидеры:
```bash
php artisan migrate --seed
```

2. Зарегистрировать тестового пользователя:
```bash
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Player",
    "email": "player@test.com", 
    "password": "password",
    "password_confirmation": "password"
  }'
```

3. Получить токен для дальнейших запросов из ответа регистрации или авторизации.

### Тест 1: Получение списка ситуаций

```bash
curl -X GET http://localhost:8000/api/situations \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Ожидаемый результат:**
- Список из 8 базовых ситуаций
- Информация о пагинации  
- Cooldown информация
- Фильтрация по уровню игрока

### Тест 2: Получение ситуации по ID

```bash
curl -X GET http://localhost:8000/api/situations/1 \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Ожидаемый результат:**
- Детали ситуации "Горящий дедлайн на работе"
- 3 варианта действий
- Информация о игроке (стресс, энергия, уровень)
- Проверка возможности начать ситуацию

### Тест 3: Случайная ситуация

```bash
curl -X GET http://localhost:8000/api/situations/random \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Ожидаемый результат:**
- Случайная ситуация доступная для уровня 1
- Все варианты действий для этого уровня

### Тест 4: Случайная ситуация по категории

```bash
curl -X GET http://localhost:8000/api/situations/random?category=work \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Ожидаемый результат:**
- Ситуация из категории "work"
- Может быть либо "Горящий дедлайн на работе"

### Тест 5: Завершение ситуации (конструктивный выбор)

```bash
curl -X POST http://localhost:8000/api/situations/1/complete \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{"option_id": 1}'
```

**Ожидаемый результат:**
- Успешное завершение ситуации
- Уменьшение стресса (-5)
- Получение опыта (+25) 
- Трата энергии (-10)
- Возможное повышение уровня
- Установка cooldown на 2 часа

### Тест 6: Попытка начать ситуацию на cooldown

```bash
curl -X GET http://localhost:8000/api/situations/random \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Ожидаемый результат:**
- Ошибка о необходимости подождать
- Время окончания cooldown

### Тест 7: Получение профиля после завершения ситуации

```bash
curl -X GET http://localhost:8000/api/player/profile \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Ожидаемый результат:**
- Обновленные характеристики (стресс, энергия, опыт)
- Возможно новый уровень

### Тест 8: История ситуаций

```bash
curl -X GET http://localhost:8000/api/situations/history \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Ожидаемый результат:**
- Запись о пройденной ситуации
- Выбранный вариант действия
- Полученные награды

### Тест 9: Рекомендации ситуаций

```bash
curl -X GET http://localhost:8000/api/situations/recommendations \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Ожидаемый результат:**
- Персонализированные рекомендации
- Учет текущего стресса игрока
- Исключение уже пройденных ситуаций

### Тест 10: Фильтрация по категории

```bash
curl -X GET http://localhost:8000/api/situations?category=health \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Ожидаемый результат:**
- Только ситуации категории "health"
- "Бессонная ночь" и "Проблемы с концентрацией"

## Проверка игровой логики

### Логика стресса:
1. Конструктивные действия должны уменьшать стресс
2. Деструктивные действия должны увеличивать стресс  
3. Стресс не должен выходить за границы 0-100

### Логика энергии:
1. Действия тратят энергию согласно настройкам
2. Энергия не должна уходить в минус
3. Если энергии недостаточно - должна быть ошибка

### Логика опыта и уровней:
1. За действия начисляется опыт
2. При достижении 100 опыта происходит повышение уровня
3. Событие повышения уровня логируется

### Логика cooldown:
1. После завершения ситуации устанавливается cooldown
2. Новые ситуации недоступны до окончания cooldown
3. Cooldown можно настроить через конфиг

## Ожидаемые ошибки

### 401 Unauthorized
- Запрос без токена авторизации

### 404 Not Found  
- Несуществующая ситуация
- Профиль игрока не найден

### 400 Bad Request
- Попытка начать ситуацию на cooldown
- Недостаточно энергии для действия
- Недостаточный уровень для ситуации/действия

### 422 Validation Error
- Неверные параметры запроса
- Неизвестная категория ситуации

## Логи для проверки

Все действия должны записываться в таблицу `activity_logs`:
- `situation.completed` - завершение ситуации
- `player.level_up` - повышение уровня  
- `player.experience_added` - добавление опыта
- `player.stress_updated` - изменение стресса
- `player.energy_updated` - изменение энергии

**После прохождения всех тестов система ситуаций полностью функциональна!**
